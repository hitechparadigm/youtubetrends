"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const trend_repository_1 = require("../../src/repositories/trend-repository");
// Mock AWS SDK
jest.mock('@aws-sdk/client-dynamodb');
jest.mock('@aws-sdk/lib-dynamodb');
describe('TrendRepository', () => {
    let repository;
    let mockClient;
    beforeEach(() => {
        // Mock DynamoDB client
        mockClient = {
            send: jest.fn()
        };
        // Mock the DynamoDBDocumentClient.from method
        const { DynamoDBDocumentClient } = require('@aws-sdk/lib-dynamodb');
        DynamoDBDocumentClient.from = jest.fn().mockReturnValue(mockClient);
        repository = new trend_repository_1.TrendRepository({ region: 'us-east-1' });
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('saveTrend', () => {
        it('should save a trend to DynamoDB', async () => {
            const trend = {
                topic: 'tourism',
                timestamp: '2024-01-01T00:00:00.000Z',
                videoId: 'test123',
                title: 'Test Video',
                viewCount: 1000,
                likeCount: 50,
                commentCount: 10,
                engagementRate: 6,
                engagementScore: 0.03,
                keywords: ['travel', 'vacation'],
                categoryId: '19',
                publishedAt: '2024-01-01T00:00:00.000Z',
                channelTitle: 'Test Channel',
                channelId: 'channel123'
            };
            mockClient.send.mockResolvedValue({});
            await repository.saveTrend(trend);
            expect(mockClient.send).toHaveBeenCalledTimes(1);
        });
    });
    describe('getTrendsByTopic', () => {
        it('should retrieve trends by topic', async () => {
            const mockItems = [
                {
                    topic: 'tourism',
                    timestamp: '2024-01-01T00:00:00.000Z',
                    videoId: 'test123',
                    title: 'Test Video',
                    viewCount: 1000,
                    likeCount: 50,
                    commentCount: 10,
                    engagementRate: 6,
                    engagementScore: 0.03,
                    keywords: ['travel'],
                    categoryId: '19',
                    publishedAt: '2024-01-01T00:00:00.000Z',
                    channelTitle: 'Test Channel',
                    channelId: 'channel123'
                }
            ];
            mockClient.send.mockResolvedValue({ Items: mockItems });
            const result = await repository.getTrendsByTopic('tourism');
            expect(result).toHaveLength(1);
            expect(result[0].topic).toBe('tourism');
            expect(result[0].videoId).toBe('test123');
        });
        it('should handle time range filters', async () => {
            mockClient.send.mockResolvedValue({ Items: [] });
            await repository.getTrendsByTopic('tourism', {
                startTime: '2024-01-01T00:00:00.000Z',
                endTime: '2024-01-02T00:00:00.000Z'
            });
            expect(mockClient.send).toHaveBeenCalledTimes(1);
        });
    });
    describe('getTopTrendsByEngagement', () => {
        it('should retrieve top trends by engagement score', async () => {
            const mockItems = [
                {
                    topic: 'tourism',
                    timestamp: '2024-01-01T00:00:00.000Z',
                    videoId: 'test123',
                    engagementScore: 0.05,
                    title: 'High Engagement Video',
                    viewCount: 1000,
                    likeCount: 50,
                    commentCount: 10,
                    engagementRate: 6,
                    keywords: ['travel'],
                    categoryId: '19',
                    publishedAt: '2024-01-01T00:00:00.000Z',
                    channelTitle: 'Test Channel',
                    channelId: 'channel123'
                }
            ];
            mockClient.send.mockResolvedValue({ Items: mockItems });
            const result = await repository.getTopTrendsByEngagement(10);
            expect(result).toHaveLength(1);
            expect(result[0].engagementScore).toBe(0.05);
            expect(mockClient.send).toHaveBeenCalledTimes(1);
        });
    });
    describe('getTrendAnalysis', () => {
        it('should return analysis for empty trends', async () => {
            mockClient.send.mockResolvedValue({ Items: [] });
            const result = await repository.getTrendAnalysis('tourism');
            expect(result.totalTrends).toBe(0);
            expect(result.averageEngagementRate).toBe(0);
            expect(result.topEngagementScore).toBe(0);
        });
        it('should calculate correct analysis metrics', async () => {
            const mockItems = [
                {
                    topic: 'tourism',
                    timestamp: '2024-01-01T00:00:00.000Z',
                    videoId: 'test1',
                    engagementRate: 5,
                    engagementScore: 0.03,
                    title: 'Video 1',
                    viewCount: 1000,
                    likeCount: 30,
                    commentCount: 20,
                    keywords: ['travel'],
                    categoryId: '19',
                    publishedAt: '2024-01-01T00:00:00.000Z',
                    channelTitle: 'Channel 1',
                    channelId: 'channel1'
                },
                {
                    topic: 'tourism',
                    timestamp: '2024-01-01T01:00:00.000Z',
                    videoId: 'test2',
                    engagementRate: 7,
                    engagementScore: 0.05,
                    title: 'Video 2',
                    viewCount: 2000,
                    likeCount: 70,
                    commentCount: 30,
                    keywords: ['vacation'],
                    categoryId: '19',
                    publishedAt: '2024-01-01T00:00:00.000Z',
                    channelTitle: 'Channel 2',
                    channelId: 'channel2'
                }
            ];
            mockClient.send.mockResolvedValue({ Items: mockItems });
            const result = await repository.getTrendAnalysis('tourism');
            expect(result.totalTrends).toBe(2);
            expect(result.averageEngagementRate).toBe(6); // (5 + 7) / 2
            expect(result.topEngagementScore).toBe(0.05);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlbmQtcmVwb3NpdG9yeS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidHJlbmQtcmVwb3NpdG9yeS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOEVBQTBFO0FBRzFFLGVBQWU7QUFDZixJQUFJLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBRW5DLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsSUFBSSxVQUEyQixDQUFDO0lBQ2hDLElBQUksVUFBZSxDQUFDO0lBRXBCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCx1QkFBdUI7UUFDdkIsVUFBVSxHQUFHO1lBQ1gsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDaEIsQ0FBQztRQUVGLDhDQUE4QztRQUM5QyxNQUFNLEVBQUUsc0JBQXNCLEVBQUUsR0FBRyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUNwRSxzQkFBc0IsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVwRSxVQUFVLEdBQUcsSUFBSSxrQ0FBZSxDQUFDLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUM7SUFDNUQsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9DLE1BQU0sS0FBSyxHQUFjO2dCQUN2QixLQUFLLEVBQUUsU0FBUztnQkFDaEIsU0FBUyxFQUFFLDBCQUEwQjtnQkFDckMsT0FBTyxFQUFFLFNBQVM7Z0JBQ2xCLEtBQUssRUFBRSxZQUFZO2dCQUNuQixTQUFTLEVBQUUsSUFBSTtnQkFDZixTQUFTLEVBQUUsRUFBRTtnQkFDYixZQUFZLEVBQUUsRUFBRTtnQkFDaEIsY0FBYyxFQUFFLENBQUM7Z0JBQ2pCLGVBQWUsRUFBRSxJQUFJO2dCQUNyQixRQUFRLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDO2dCQUNoQyxVQUFVLEVBQUUsSUFBSTtnQkFDaEIsV0FBVyxFQUFFLDBCQUEwQjtnQkFDdkMsWUFBWSxFQUFFLGNBQWM7Z0JBQzVCLFNBQVMsRUFBRSxZQUFZO2FBQ3hCLENBQUM7WUFFRixVQUFVLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXRDLE1BQU0sVUFBVSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVsQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQyxNQUFNLFNBQVMsR0FBRztnQkFDaEI7b0JBQ0UsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLFNBQVMsRUFBRSwwQkFBMEI7b0JBQ3JDLE9BQU8sRUFBRSxTQUFTO29CQUNsQixLQUFLLEVBQUUsWUFBWTtvQkFDbkIsU0FBUyxFQUFFLElBQUk7b0JBQ2YsU0FBUyxFQUFFLEVBQUU7b0JBQ2IsWUFBWSxFQUFFLEVBQUU7b0JBQ2hCLGNBQWMsRUFBRSxDQUFDO29CQUNqQixlQUFlLEVBQUUsSUFBSTtvQkFDckIsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDO29CQUNwQixVQUFVLEVBQUUsSUFBSTtvQkFDaEIsV0FBVyxFQUFFLDBCQUEwQjtvQkFDdkMsWUFBWSxFQUFFLGNBQWM7b0JBQzVCLFNBQVMsRUFBRSxZQUFZO2lCQUN4QjthQUNGLENBQUM7WUFFRixVQUFVLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7WUFFeEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFNUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRCxVQUFVLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFakQsTUFBTSxVQUFVLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFO2dCQUMzQyxTQUFTLEVBQUUsMEJBQTBCO2dCQUNyQyxPQUFPLEVBQUUsMEJBQTBCO2FBQ3BDLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlELE1BQU0sU0FBUyxHQUFHO2dCQUNoQjtvQkFDRSxLQUFLLEVBQUUsU0FBUztvQkFDaEIsU0FBUyxFQUFFLDBCQUEwQjtvQkFDckMsT0FBTyxFQUFFLFNBQVM7b0JBQ2xCLGVBQWUsRUFBRSxJQUFJO29CQUNyQixLQUFLLEVBQUUsdUJBQXVCO29CQUM5QixTQUFTLEVBQUUsSUFBSTtvQkFDZixTQUFTLEVBQUUsRUFBRTtvQkFDYixZQUFZLEVBQUUsRUFBRTtvQkFDaEIsY0FBYyxFQUFFLENBQUM7b0JBQ2pCLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQztvQkFDcEIsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLFdBQVcsRUFBRSwwQkFBMEI7b0JBQ3ZDLFlBQVksRUFBRSxjQUFjO29CQUM1QixTQUFTLEVBQUUsWUFBWTtpQkFDeEI7YUFDRixDQUFDO1lBRUYsVUFBVSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1lBRXhELE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHdCQUF3QixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRTdELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMseUNBQXlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkQsVUFBVSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRWpELE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTVELE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RCxNQUFNLFNBQVMsR0FBRztnQkFDaEI7b0JBQ0UsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLFNBQVMsRUFBRSwwQkFBMEI7b0JBQ3JDLE9BQU8sRUFBRSxPQUFPO29CQUNoQixjQUFjLEVBQUUsQ0FBQztvQkFDakIsZUFBZSxFQUFFLElBQUk7b0JBQ3JCLEtBQUssRUFBRSxTQUFTO29CQUNoQixTQUFTLEVBQUUsSUFBSTtvQkFDZixTQUFTLEVBQUUsRUFBRTtvQkFDYixZQUFZLEVBQUUsRUFBRTtvQkFDaEIsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDO29CQUNwQixVQUFVLEVBQUUsSUFBSTtvQkFDaEIsV0FBVyxFQUFFLDBCQUEwQjtvQkFDdkMsWUFBWSxFQUFFLFdBQVc7b0JBQ3pCLFNBQVMsRUFBRSxVQUFVO2lCQUN0QjtnQkFDRDtvQkFDRSxLQUFLLEVBQUUsU0FBUztvQkFDaEIsU0FBUyxFQUFFLDBCQUEwQjtvQkFDckMsT0FBTyxFQUFFLE9BQU87b0JBQ2hCLGNBQWMsRUFBRSxDQUFDO29CQUNqQixlQUFlLEVBQUUsSUFBSTtvQkFDckIsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLFNBQVMsRUFBRSxJQUFJO29CQUNmLFNBQVMsRUFBRSxFQUFFO29CQUNiLFlBQVksRUFBRSxFQUFFO29CQUNoQixRQUFRLEVBQUUsQ0FBQyxVQUFVLENBQUM7b0JBQ3RCLFVBQVUsRUFBRSxJQUFJO29CQUNoQixXQUFXLEVBQUUsMEJBQTBCO29CQUN2QyxZQUFZLEVBQUUsV0FBVztvQkFDekIsU0FBUyxFQUFFLFVBQVU7aUJBQ3RCO2FBQ0YsQ0FBQztZQUVGLFVBQVUsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztZQUV4RCxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUU1RCxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYztZQUM1RCxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyZW5kUmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uL3NyYy9yZXBvc2l0b3JpZXMvdHJlbmQtcmVwb3NpdG9yeSc7XHJcbmltcG9ydCB7IFRyZW5kRGF0YSwgVHJlbmREYXRhTW9kZWwgfSBmcm9tICcuLi8uLi9zcmMvbW9kZWxzL3RyZW5kLWRhdGEnO1xyXG5cclxuLy8gTW9jayBBV1MgU0RLXHJcbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LWR5bmFtb2RiJyk7XHJcbmplc3QubW9jaygnQGF3cy1zZGsvbGliLWR5bmFtb2RiJyk7XHJcblxyXG5kZXNjcmliZSgnVHJlbmRSZXBvc2l0b3J5JywgKCkgPT4ge1xyXG4gIGxldCByZXBvc2l0b3J5OiBUcmVuZFJlcG9zaXRvcnk7XHJcbiAgbGV0IG1vY2tDbGllbnQ6IGFueTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAvLyBNb2NrIER5bmFtb0RCIGNsaWVudFxyXG4gICAgbW9ja0NsaWVudCA9IHtcclxuICAgICAgc2VuZDogamVzdC5mbigpXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIE1vY2sgdGhlIER5bmFtb0RCRG9jdW1lbnRDbGllbnQuZnJvbSBtZXRob2RcclxuICAgIGNvbnN0IHsgRHluYW1vREJEb2N1bWVudENsaWVudCB9ID0gcmVxdWlyZSgnQGF3cy1zZGsvbGliLWR5bmFtb2RiJyk7XHJcbiAgICBEeW5hbW9EQkRvY3VtZW50Q2xpZW50LmZyb20gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tDbGllbnQpO1xyXG5cclxuICAgIHJlcG9zaXRvcnkgPSBuZXcgVHJlbmRSZXBvc2l0b3J5KHsgcmVnaW9uOiAndXMtZWFzdC0xJyB9KTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnc2F2ZVRyZW5kJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBzYXZlIGEgdHJlbmQgdG8gRHluYW1vREInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRyZW5kOiBUcmVuZERhdGEgPSB7XHJcbiAgICAgICAgdG9waWM6ICd0b3VyaXNtJyxcclxuICAgICAgICB0aW1lc3RhbXA6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgIHZpZGVvSWQ6ICd0ZXN0MTIzJyxcclxuICAgICAgICB0aXRsZTogJ1Rlc3QgVmlkZW8nLFxyXG4gICAgICAgIHZpZXdDb3VudDogMTAwMCxcclxuICAgICAgICBsaWtlQ291bnQ6IDUwLFxyXG4gICAgICAgIGNvbW1lbnRDb3VudDogMTAsXHJcbiAgICAgICAgZW5nYWdlbWVudFJhdGU6IDYsXHJcbiAgICAgICAgZW5nYWdlbWVudFNjb3JlOiAwLjAzLFxyXG4gICAgICAgIGtleXdvcmRzOiBbJ3RyYXZlbCcsICd2YWNhdGlvbiddLFxyXG4gICAgICAgIGNhdGVnb3J5SWQ6ICcxOScsXHJcbiAgICAgICAgcHVibGlzaGVkQXQ6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgIGNoYW5uZWxUaXRsZTogJ1Rlc3QgQ2hhbm5lbCcsXHJcbiAgICAgICAgY2hhbm5lbElkOiAnY2hhbm5lbDEyMydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tDbGllbnQuc2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcblxyXG4gICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmVUcmVuZCh0cmVuZCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja0NsaWVudC5zZW5kKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFRyZW5kc0J5VG9waWMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIHRyZW5kcyBieSB0b3BpYycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0l0ZW1zID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRvcGljOiAndG91cmlzbScsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgICAgdmlkZW9JZDogJ3Rlc3QxMjMnLFxyXG4gICAgICAgICAgdGl0bGU6ICdUZXN0IFZpZGVvJyxcclxuICAgICAgICAgIHZpZXdDb3VudDogMTAwMCxcclxuICAgICAgICAgIGxpa2VDb3VudDogNTAsXHJcbiAgICAgICAgICBjb21tZW50Q291bnQ6IDEwLFxyXG4gICAgICAgICAgZW5nYWdlbWVudFJhdGU6IDYsXHJcbiAgICAgICAgICBlbmdhZ2VtZW50U2NvcmU6IDAuMDMsXHJcbiAgICAgICAgICBrZXl3b3JkczogWyd0cmF2ZWwnXSxcclxuICAgICAgICAgIGNhdGVnb3J5SWQ6ICcxOScsXHJcbiAgICAgICAgICBwdWJsaXNoZWRBdDogJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicsXHJcbiAgICAgICAgICBjaGFubmVsVGl0bGU6ICdUZXN0IENoYW5uZWwnLFxyXG4gICAgICAgICAgY2hhbm5lbElkOiAnY2hhbm5lbDEyMydcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrQ2xpZW50LnNlbmQubW9ja1Jlc29sdmVkVmFsdWUoeyBJdGVtczogbW9ja0l0ZW1zIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5nZXRUcmVuZHNCeVRvcGljKCd0b3VyaXNtJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0udG9waWMpLnRvQmUoJ3RvdXJpc20nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS52aWRlb0lkKS50b0JlKCd0ZXN0MTIzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0aW1lIHJhbmdlIGZpbHRlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDbGllbnQuc2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IEl0ZW1zOiBbXSB9KTtcclxuXHJcbiAgICAgIGF3YWl0IHJlcG9zaXRvcnkuZ2V0VHJlbmRzQnlUb3BpYygndG91cmlzbScsIHtcclxuICAgICAgICBzdGFydFRpbWU6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgIGVuZFRpbWU6ICcyMDI0LTAxLTAyVDAwOjAwOjAwLjAwMFonXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tDbGllbnQuc2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRUb3BUcmVuZHNCeUVuZ2FnZW1lbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIHRvcCB0cmVuZHMgYnkgZW5nYWdlbWVudCBzY29yZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0l0ZW1zID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRvcGljOiAndG91cmlzbScsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgICAgdmlkZW9JZDogJ3Rlc3QxMjMnLFxyXG4gICAgICAgICAgZW5nYWdlbWVudFNjb3JlOiAwLjA1LFxyXG4gICAgICAgICAgdGl0bGU6ICdIaWdoIEVuZ2FnZW1lbnQgVmlkZW8nLFxyXG4gICAgICAgICAgdmlld0NvdW50OiAxMDAwLFxyXG4gICAgICAgICAgbGlrZUNvdW50OiA1MCxcclxuICAgICAgICAgIGNvbW1lbnRDb3VudDogMTAsXHJcbiAgICAgICAgICBlbmdhZ2VtZW50UmF0ZTogNixcclxuICAgICAgICAgIGtleXdvcmRzOiBbJ3RyYXZlbCddLFxyXG4gICAgICAgICAgY2F0ZWdvcnlJZDogJzE5JyxcclxuICAgICAgICAgIHB1Ymxpc2hlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcclxuICAgICAgICAgIGNoYW5uZWxUaXRsZTogJ1Rlc3QgQ2hhbm5lbCcsXHJcbiAgICAgICAgICBjaGFubmVsSWQ6ICdjaGFubmVsMTIzJ1xyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuXHJcbiAgICAgIG1vY2tDbGllbnQuc2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IEl0ZW1zOiBtb2NrSXRlbXMgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmdldFRvcFRyZW5kc0J5RW5nYWdlbWVudCgxMCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uZW5nYWdlbWVudFNjb3JlKS50b0JlKDAuMDUpO1xyXG4gICAgICBleHBlY3QobW9ja0NsaWVudC5zZW5kKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFRyZW5kQW5hbHlzaXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbmFseXNpcyBmb3IgZW1wdHkgdHJlbmRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrQ2xpZW50LnNlbmQubW9ja1Jlc29sdmVkVmFsdWUoeyBJdGVtczogW10gfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmdldFRyZW5kQW5hbHlzaXMoJ3RvdXJpc20nKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxUcmVuZHMpLnRvQmUoMCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYXZlcmFnZUVuZ2FnZW1lbnRSYXRlKS50b0JlKDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRvcEVuZ2FnZW1lbnRTY29yZSkudG9CZSgwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGNvcnJlY3QgYW5hbHlzaXMgbWV0cmljcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0l0ZW1zID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRvcGljOiAndG91cmlzbScsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgICAgdmlkZW9JZDogJ3Rlc3QxJyxcclxuICAgICAgICAgIGVuZ2FnZW1lbnRSYXRlOiA1LFxyXG4gICAgICAgICAgZW5nYWdlbWVudFNjb3JlOiAwLjAzLFxyXG4gICAgICAgICAgdGl0bGU6ICdWaWRlbyAxJyxcclxuICAgICAgICAgIHZpZXdDb3VudDogMTAwMCxcclxuICAgICAgICAgIGxpa2VDb3VudDogMzAsXHJcbiAgICAgICAgICBjb21tZW50Q291bnQ6IDIwLFxyXG4gICAgICAgICAga2V5d29yZHM6IFsndHJhdmVsJ10sXHJcbiAgICAgICAgICBjYXRlZ29yeUlkOiAnMTknLFxyXG4gICAgICAgICAgcHVibGlzaGVkQXQ6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgICAgY2hhbm5lbFRpdGxlOiAnQ2hhbm5lbCAxJyxcclxuICAgICAgICAgIGNoYW5uZWxJZDogJ2NoYW5uZWwxJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdG9waWM6ICd0b3VyaXNtJyxcclxuICAgICAgICAgIHRpbWVzdGFtcDogJzIwMjQtMDEtMDFUMDE6MDA6MDAuMDAwWicsXHJcbiAgICAgICAgICB2aWRlb0lkOiAndGVzdDInLFxyXG4gICAgICAgICAgZW5nYWdlbWVudFJhdGU6IDcsXHJcbiAgICAgICAgICBlbmdhZ2VtZW50U2NvcmU6IDAuMDUsXHJcbiAgICAgICAgICB0aXRsZTogJ1ZpZGVvIDInLFxyXG4gICAgICAgICAgdmlld0NvdW50OiAyMDAwLFxyXG4gICAgICAgICAgbGlrZUNvdW50OiA3MCxcclxuICAgICAgICAgIGNvbW1lbnRDb3VudDogMzAsXHJcbiAgICAgICAgICBrZXl3b3JkczogWyd2YWNhdGlvbiddLFxyXG4gICAgICAgICAgY2F0ZWdvcnlJZDogJzE5JyxcclxuICAgICAgICAgIHB1Ymxpc2hlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcclxuICAgICAgICAgIGNoYW5uZWxUaXRsZTogJ0NoYW5uZWwgMicsXHJcbiAgICAgICAgICBjaGFubmVsSWQ6ICdjaGFubmVsMidcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrQ2xpZW50LnNlbmQubW9ja1Jlc29sdmVkVmFsdWUoeyBJdGVtczogbW9ja0l0ZW1zIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5nZXRUcmVuZEFuYWx5c2lzKCd0b3VyaXNtJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsVHJlbmRzKS50b0JlKDIpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmF2ZXJhZ2VFbmdhZ2VtZW50UmF0ZSkudG9CZSg2KTsgLy8gKDUgKyA3KSAvIDJcclxuICAgICAgZXhwZWN0KHJlc3VsdC50b3BFbmdhZ2VtZW50U2NvcmUpLnRvQmUoMC4wNSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il19