"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const video_repository_1 = require("../../src/repositories/video-repository");
const video_metadata_1 = require("../../src/models/video-metadata");
// Mock AWS SDK
jest.mock('@aws-sdk/client-dynamodb');
jest.mock('@aws-sdk/lib-dynamodb');
describe('VideoRepository', () => {
    let repository;
    let mockClient;
    beforeEach(() => {
        // Mock DynamoDB client
        mockClient = {
            send: jest.fn()
        };
        // Mock the DynamoDBDocumentClient.from method
        const { DynamoDBDocumentClient } = require('@aws-sdk/lib-dynamodb');
        DynamoDBDocumentClient.from = jest.fn().mockReturnValue(mockClient);
        repository = new video_repository_1.VideoRepository({ region: 'us-east-1' });
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('saveVideo', () => {
        it('should save a video to DynamoDB', async () => {
            const video = video_metadata_1.VideoMetadataModel.create('Test Video', 'Test Description', ['tag1', 'tag2'], ['tourism'], 's3://bucket/video.mp4');
            mockClient.send.mockResolvedValue({});
            await repository.saveVideo(video);
            expect(mockClient.send).toHaveBeenCalledTimes(1);
        });
    });
    describe('getVideo', () => {
        it('should retrieve a video by ID', async () => {
            const mockItem = {
                videoId: 'test123',
                title: 'Test Video',
                description: 'Test Description',
                tags: ['tag1'],
                sourceTrends: ['tourism'],
                s3Key: 's3://bucket/video.mp4',
                status: video_metadata_1.VideoStatus.PUBLISHED,
                uploadDate: '2024-01-01',
                categoryId: '22',
                privacyStatus: 'public',
                viewCount: 1000,
                likeCount: 50,
                commentCount: 10,
                revenue: 0,
                generationCost: 0,
                processingCost: 0,
                performanceMetrics: {},
                createdAt: '2024-01-01T00:00:00.000Z',
                updatedAt: '2024-01-01T00:00:00.000Z'
            };
            mockClient.send.mockResolvedValue({ Item: mockItem });
            const result = await repository.getVideo('test123');
            expect(result).not.toBeNull();
            expect(result?.videoId).toBe('test123');
            expect(result?.title).toBe('Test Video');
        });
        it('should return null for non-existent video', async () => {
            mockClient.send.mockResolvedValue({});
            const result = await repository.getVideo('nonexistent');
            expect(result).toBeNull();
        });
    });
    describe('updateVideoStatus', () => {
        it('should update video status', async () => {
            const updatedItem = {
                videoId: 'test123',
                status: video_metadata_1.VideoStatus.PUBLISHED,
                updatedAt: '2024-01-01T01:00:00.000Z',
                title: 'Test Video',
                description: 'Test Description',
                tags: ['tag1'],
                sourceTrends: ['tourism'],
                s3Key: 's3://bucket/video.mp4',
                uploadDate: '2024-01-01',
                categoryId: '22',
                privacyStatus: 'public',
                viewCount: 0,
                likeCount: 0,
                commentCount: 0,
                revenue: 0,
                generationCost: 0,
                processingCost: 0,
                performanceMetrics: {},
                createdAt: '2024-01-01T00:00:00.000Z'
            };
            mockClient.send.mockResolvedValue({ Attributes: updatedItem });
            const result = await repository.updateVideoStatus('test123', video_metadata_1.VideoStatus.PUBLISHED);
            expect(result.status).toBe(video_metadata_1.VideoStatus.PUBLISHED);
            expect(mockClient.send).toHaveBeenCalledTimes(1);
        });
    });
    describe('getVideosByStatus', () => {
        it('should retrieve videos by status', async () => {
            const mockItems = [
                {
                    videoId: 'test1',
                    status: video_metadata_1.VideoStatus.GENERATING,
                    title: 'Video 1',
                    description: 'Description 1',
                    tags: ['tag1'],
                    sourceTrends: ['tourism'],
                    s3Key: 's3://bucket/video1.mp4',
                    uploadDate: '2024-01-01',
                    categoryId: '22',
                    privacyStatus: 'public',
                    viewCount: 0,
                    likeCount: 0,
                    commentCount: 0,
                    revenue: 0,
                    generationCost: 0,
                    processingCost: 0,
                    performanceMetrics: {},
                    createdAt: '2024-01-01T00:00:00.000Z',
                    updatedAt: '2024-01-01T00:00:00.000Z'
                }
            ];
            mockClient.send.mockResolvedValue({ Items: mockItems });
            const result = await repository.getVideosByStatus(video_metadata_1.VideoStatus.GENERATING);
            expect(result).toHaveLength(1);
            expect(result[0].status).toBe(video_metadata_1.VideoStatus.GENERATING);
        });
    });
    describe('getVideoAnalytics', () => {
        it('should calculate correct analytics', async () => {
            const mockItems = [
                {
                    videoId: 'test1',
                    status: video_metadata_1.VideoStatus.PUBLISHED,
                    viewCount: 1000,
                    revenue: 10,
                    generationCost: 2,
                    processingCost: 1,
                    uploadDate: '2024-01-01',
                    title: 'Video 1',
                    description: 'Description 1',
                    tags: ['tag1'],
                    sourceTrends: ['tourism'],
                    s3Key: 's3://bucket/video1.mp4',
                    categoryId: '22',
                    privacyStatus: 'public',
                    likeCount: 50,
                    commentCount: 10,
                    performanceMetrics: {},
                    createdAt: '2024-01-01T00:00:00.000Z',
                    updatedAt: '2024-01-01T00:00:00.000Z'
                },
                {
                    videoId: 'test2',
                    status: video_metadata_1.VideoStatus.GENERATING,
                    viewCount: 0,
                    revenue: 0,
                    generationCost: 2,
                    processingCost: 1,
                    uploadDate: '2024-01-01',
                    title: 'Video 2',
                    description: 'Description 2',
                    tags: ['tag2'],
                    sourceTrends: ['travel'],
                    s3Key: 's3://bucket/video2.mp4',
                    categoryId: '22',
                    privacyStatus: 'public',
                    likeCount: 0,
                    commentCount: 0,
                    performanceMetrics: {},
                    createdAt: '2024-01-01T00:00:00.000Z',
                    updatedAt: '2024-01-01T00:00:00.000Z'
                }
            ];
            mockClient.send.mockResolvedValue({ Items: mockItems });
            const result = await repository.getVideoAnalytics(30);
            expect(result.totalVideos).toBe(2);
            expect(result.publishedVideos).toBe(1);
            expect(result.totalViews).toBe(1000);
            expect(result.totalRevenue).toBe(10);
            expect(result.totalCosts).toBe(6); // (2+1) + (2+1)
            expect(result.statusBreakdown[video_metadata_1.VideoStatus.PUBLISHED]).toBe(1);
            expect(result.statusBreakdown[video_metadata_1.VideoStatus.GENERATING]).toBe(1);
        });
    });
    describe('updatePerformanceMetrics', () => {
        it('should update performance metrics', async () => {
            const existingVideo = video_metadata_1.VideoMetadataModel.create('Test Video', 'Test Description', ['tag1'], ['tourism'], 's3://bucket/video.mp4');
            // Mock getVideo call
            mockClient.send
                .mockResolvedValueOnce({ Item: video_metadata_1.VideoMetadataModel.toDynamoDbItem(existingVideo) })
                .mockResolvedValueOnce({
                Attributes: {
                    ...video_metadata_1.VideoMetadataModel.toDynamoDbItem(existingVideo),
                    performanceMetrics: { impressions: 5000, clickThroughRate: 0.05 }
                }
            });
            const result = await repository.updatePerformanceMetrics(existingVideo.videoId, {
                impressions: 5000,
                clickThroughRate: 0.05
            });
            expect(result.performanceMetrics.impressions).toBe(5000);
            expect(result.performanceMetrics.clickThroughRate).toBe(0.05);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlkZW8tcmVwb3NpdG9yeS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidmlkZW8tcmVwb3NpdG9yeS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOEVBQTBFO0FBQzFFLG9FQUFpRztBQUVqRyxlQUFlO0FBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3RDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUVuQyxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksVUFBMkIsQ0FBQztJQUNoQyxJQUFJLFVBQWUsQ0FBQztJQUVwQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsdUJBQXVCO1FBQ3ZCLFVBQVUsR0FBRztZQUNYLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2hCLENBQUM7UUFFRiw4Q0FBOEM7UUFDOUMsTUFBTSxFQUFFLHNCQUFzQixFQUFFLEdBQUcsT0FBTyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDcEUsc0JBQXNCLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFcEUsVUFBVSxHQUFHLElBQUksa0NBQWUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO0lBQzVELENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQyxNQUFNLEtBQUssR0FBRyxtQ0FBa0IsQ0FBQyxNQUFNLENBQ3JDLFlBQVksRUFDWixrQkFBa0IsRUFDbEIsQ0FBQyxNQUFNLEVB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LElBQUksRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUU7aUJBQ2xFO2FBQ0YsQ0FBQyxDQUFDO1lBRUwsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsd0JBQXdCLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRTtnQkFDOUUsV0FBVyxFQUFFLElBQUk7Z0JBQ2pCLGdCQUFnQixFQUFFLElBQUk7YUFDdkIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDekQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWaWRlb1JlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi9zcmMvcmVwb3NpdG9yaWVzL3ZpZGVvLXJlcG9zaXRvcnknO1xyXG5pbXBvcnQgeyBWaWRlb01ldGFkYXRhLCBWaWRlb01ldGFkYXRhTW9kZWwsIFZpZGVvU3RhdHVzIH0gZnJvbSAnLi4vLi4vc3JjL21vZGVscy92aWRlby1tZXRhZGF0YSc7XHJcblxyXG4vLyBNb2NrIEFXUyBTREtcclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtZHluYW1vZGInKTtcclxuamVzdC5tb2NrKCdAYXdzLXNkay9saWItZHluYW1vZGInKTtcclxuXHJcbmRlc2NyaWJlKCdWaWRlb1JlcG9zaXRvcnknLCAoKSA9PiB7XHJcbiAgbGV0IHJlcG9zaXRvcnk6IFZpZGVvUmVwb3NpdG9yeTtcclxuICBsZXQgbW9ja0NsaWVudDogYW55O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIC8vIE1vY2sgRHluYW1vREIgY2xpZW50XHJcbiAgICBtb2NrQ2xpZW50ID0ge1xyXG4gICAgICBzZW5kOiBqZXN0LmZuKClcclxuICAgIH07XHJcblxyXG4gICAgLy8gTW9jayB0aGUgRHluYW1vREJEb2N1bWVudENsaWVudC5mcm9tIG1ldGhvZFxyXG4gICAgY29uc3QgeyBEeW5hbW9EQkRvY3VtZW50Q2xpZW50IH0gPSByZXF1aXJlKCdAYXdzLXNkay9saWItZHluYW1vZGInKTtcclxuICAgIER5bmFtb0RCRG9jdW1lbnRDbGllbnQuZnJvbSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0NsaWVudCk7XHJcblxyXG4gICAgcmVwb3NpdG9yeSA9IG5ldyBWaWRlb1JlcG9zaXRvcnkoeyByZWdpb246ICd1cy1lYXN0LTEnIH0pO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdzYXZlVmlkZW8nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHNhdmUgYSB2aWRlbyB0byBEeW5hbW9EQicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdmlkZW8gPSBWaWRlb01ldGFkYXRhTW9kZWwuY3JlYXRlKFxyXG4gICAgICAgICdUZXN0IFZpZGVvJyxcclxuICAgICAgICAnVGVzdCBEZXNjcmlwdGlvbicsXHJcbiAgICAgICAgWyd0YWcxJywgJ3RhZzInXSxcclxuICAgICAgICBbJ3RvdXJpc20nXSxcclxuICAgICAgICAnczM6Ly9idWNrZXQvdmlkZW8ubXA0J1xyXG4gICAgICApO1xyXG5cclxuICAgICAgbW9ja0NsaWVudC5zZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuXHJcbiAgICAgIGF3YWl0IHJlcG9zaXRvcnkuc2F2ZVZpZGVvKHZpZGVvKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnNlbmQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0VmlkZW8nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIGEgdmlkZW8gYnkgSUQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tJdGVtID0ge1xyXG4gICAgICAgIHZpZGVvSWQ6ICd0ZXN0MTIzJyxcclxuICAgICAgICB0aXRsZTogJ1Rlc3QgVmlkZW8nLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBEZXNjcmlwdGlvbicsXHJcbiAgICAgICAgdGFnczogWyd0YWcxJ10sXHJcbiAgICAgICAgc291cmNlVHJlbmRzOiBbJ3RvdXJpc20nXSxcclxuICAgICAgICBzM0tleTogJ3MzOi8vYnVja2V0L3ZpZGVvLm1wNCcsXHJcbiAgICAgICAgc3RhdHVzOiBWaWRlb1N0YXR1cy5QVUJMSVNIRUQsXHJcbiAgICAgICAgdXBsb2FkRGF0ZTogJzIwMjQtMDEtMDEnLFxyXG4gICAgICAgIGNhdGVnb3J5SWQ6ICcyMicsXHJcbiAgICAgICAgcHJpdmFjeVN0YXR1czogJ3B1YmxpYycsXHJcbiAgICAgICAgdmlld0NvdW50OiAxMDAwLFxyXG4gICAgICAgIGxpa2VDb3VudDogNTAsXHJcbiAgICAgICAgY29tbWVudENvdW50OiAxMCxcclxuICAgICAgICByZXZlbnVlOiAwLFxyXG4gICAgICAgIGdlbmVyYXRpb25Db3N0OiAwLFxyXG4gICAgICAgIHByb2Nlc3NpbmdDb3N0OiAwLFxyXG4gICAgICAgIHBlcmZvcm1hbmNlTWV0cmljczoge30sXHJcbiAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcclxuICAgICAgICB1cGRhdGVkQXQ6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrQ2xpZW50LnNlbmQubW9ja1Jlc29sdmVkVmFsdWUoeyBJdGVtOiBtb2NrSXRlbSB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZ2V0VmlkZW8oJ3Rlc3QxMjMnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLm5vdC50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Py52aWRlb0lkKS50b0JlKCd0ZXN0MTIzJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQ/LnRpdGxlKS50b0JlKCdUZXN0IFZpZGVvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIGZvciBub24tZXhpc3RlbnQgdmlkZW8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDbGllbnQuc2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LmdldFZpZGVvKCdub25leGlzdGVudCcpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBkYXRlVmlkZW9TdGF0dXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB2aWRlbyBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRJdGVtID0ge1xyXG4gICAgICAgIHZpZGVvSWQ6ICd0ZXN0MTIzJyxcclxuICAgICAgICBzdGF0dXM6IFZpZGVvU3RhdHVzLlBVQkxJU0hFRCxcclxuICAgICAgICB1cGRhdGVkQXQ6ICcyMDI0LTAxLTAxVDAxOjAwOjAwLjAwMFonLFxyXG4gICAgICAgIHRpdGxlOiAnVGVzdCBWaWRlbycsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IERlc2NyaXB0aW9uJyxcclxuICAgICAgICB0YWdzOiBbJ3RhZzEnXSxcclxuICAgICAgICBzb3VyY2VUcmVuZHM6IFsndG91cmlzbSddLFxyXG4gICAgICAgIHMzS2V5OiAnczM6Ly9idWNrZXQvdmlkZW8ubXA0JyxcclxuICAgICAgICB1cGxvYWREYXRlOiAnMjAyNC0wMS0wMScsXHJcbiAgICAgICAgY2F0ZWdvcnlJZDogJzIyJyxcclxuICAgICAgICBwcml2YWN5U3RhdHVzOiAncHVibGljJyxcclxuICAgICAgICB2aWV3Q291bnQ6IDAsXHJcbiAgICAgICAgbGlrZUNvdW50OiAwLFxyXG4gICAgICAgIGNvbW1lbnRDb3VudDogMCxcclxuICAgICAgICByZXZlbnVlOiAwLFxyXG4gICAgICAgIGdlbmVyYXRpb25Db3N0OiAwLFxyXG4gICAgICAgIHByb2Nlc3NpbmdDb3N0OiAwLFxyXG4gICAgICAgIHBlcmZvcm1hbmNlTWV0cmljczoge30sXHJcbiAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0NsaWVudC5zZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHsgQXR0cmlidXRlczogdXBkYXRlZEl0ZW0gfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXBvc2l0b3J5LnVwZGF0ZVZpZGVvU3RhdHVzKCd0ZXN0MTIzJywgVmlkZW9TdGF0dXMuUFVCTElTSEVEKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFZpZGVvU3RhdHVzLlBVQkxJU0hFRCk7XHJcbiAgICAgIGV4cGVjdChtb2NrQ2xpZW50LnNlbmQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0VmlkZW9zQnlTdGF0dXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIHZpZGVvcyBieSBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tJdGVtcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICB2aWRlb0lkOiAndGVzdDEnLFxyXG4gICAgICAgICAgc3RhdHVzOiBWaWRlb1N0YXR1cy5HRU5FUkFUSU5HLFxyXG4gICAgICAgICAgdGl0bGU6ICdWaWRlbyAxJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRGVzY3JpcHRpb24gMScsXHJcbiAgICAgICAgICB0YWdzOiBbJ3RhZzEnXSxcclxuICAgICAgICAgIHNvdXJjZVRyZW5kczogWyd0b3VyaXNtJ10sXHJcbiAgICAgICAgICBzM0tleTogJ3MzOi8vYnVja2V0L3ZpZGVvMS5tcDQnLFxyXG4gICAgICAgICAgdXBsb2FkRGF0ZTogJzIwMjQtMDEtMDEnLFxyXG4gICAgICAgICAgY2F0ZWdvcnlJZDogJzIyJyxcclxuICAgICAgICAgIHByaXZhY3lTdGF0dXM6ICdwdWJsaWMnLFxyXG4gICAgICAgICAgdmlld0NvdW50OiAwLFxyXG4gICAgICAgICAgbGlrZUNvdW50OiAwLFxyXG4gICAgICAgICAgY29tbWVudENvdW50OiAwLFxyXG4gICAgICAgICAgcmV2ZW51ZTogMCxcclxuICAgICAgICAgIGdlbmVyYXRpb25Db3N0OiAwLFxyXG4gICAgICAgICAgcHJvY2Vzc2luZ0Nvc3Q6IDAsXHJcbiAgICAgICAgICBwZXJmb3JtYW5jZU1ldHJpY3M6IHt9LFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWidcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrQ2xpZW50LnNlbmQubW9ja1Jlc29sdmVkVmFsdWUoeyBJdGVtczogbW9ja0l0ZW1zIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5nZXRWaWRlb3NCeVN0YXR1cyhWaWRlb1N0YXR1cy5HRU5FUkFUSU5HKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zdGF0dXMpLnRvQmUoVmlkZW9TdGF0dXMuR0VORVJBVElORyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFZpZGVvQW5hbHl0aWNzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29ycmVjdCBhbmFseXRpY3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tJdGVtcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICB2aWRlb0lkOiAndGVzdDEnLFxyXG4gICAgICAgICAgc3RhdHVzOiBWaWRlb1N0YXR1cy5QVUJMSVNIRUQsXHJcbiAgICAgICAgICB2aWV3Q291bnQ6IDEwMDAsXHJcbiAgICAgICAgICByZXZlbnVlOiAxMCxcclxuICAgICAgICAgIGdlbmVyYXRpb25Db3N0OiAyLFxyXG4gICAgICAgICAgcHJvY2Vzc2luZ0Nvc3Q6IDEsXHJcbiAgICAgICAgICB1cGxvYWREYXRlOiAnMjAyNC0wMS0wMScsXHJcbiAgICAgICAgICB0aXRsZTogJ1ZpZGVvIDEnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdEZXNjcmlwdGlvbiAxJyxcclxuICAgICAgICAgIHRhZ3M6IFsndGFnMSddLFxyXG4gICAgICAgICAgc291cmNlVHJlbmRzOiBbJ3RvdXJpc20nXSxcclxuICAgICAgICAgIHMzS2V5OiAnczM6Ly9idWNrZXQvdmlkZW8xLm1wNCcsXHJcbiAgICAgICAgICBjYXRlZ29yeUlkOiAnMjInLFxyXG4gICAgICAgICAgcHJpdmFjeVN0YXR1czogJ3B1YmxpYycsXHJcbiAgICAgICAgICBsaWtlQ291bnQ6IDUwLFxyXG4gICAgICAgICAgY29tbWVudENvdW50OiAxMCxcclxuICAgICAgICAgIHBlcmZvcm1hbmNlTWV0cmljczoge30sXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdmlkZW9JZDogJ3Rlc3QyJyxcclxuICAgICAgICAgIHN0YXR1czogVmlkZW9TdGF0dXMuR0VORVJBVElORyxcclxuICAgICAgICAgIHZpZXdDb3VudDogMCxcclxuICAgICAgICAgIHJldmVudWU6IDAsXHJcbiAgICAgICAgICBnZW5lcmF0aW9uQ29zdDogMixcclxuICAgICAgICAgIHByb2Nlc3NpbmdDb3N0OiAxLFxyXG4gICAgICAgICAgdXBsb2FkRGF0ZTogJzIwMjQtMDEtMDEnLFxyXG4gICAgICAgICAgdGl0bGU6ICdWaWRlbyAyJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRGVzY3JpcHRpb24gMicsXHJcbiAgICAgICAgICB0YWdzOiBbJ3RhZzInXSxcclxuICAgICAgICAgIHNvdXJjZVRyZW5kczogWyd0cmF2ZWwnXSxcclxuICAgICAgICAgIHMzS2V5OiAnczM6Ly9idWNrZXQvdmlkZW8yLm1wNCcsXHJcbiAgICAgICAgICBjYXRlZ29yeUlkOiAnMjInLFxyXG4gICAgICAgICAgcHJpdmFjeVN0YXR1czogJ3B1YmxpYycsXHJcbiAgICAgICAgICBsaWtlQ291bnQ6IDAsXHJcbiAgICAgICAgICBjb21tZW50Q291bnQ6IDAsXHJcbiAgICAgICAgICBwZXJmb3JtYW5jZU1ldHJpY3M6IHt9LFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWidcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrQ2xpZW50LnNlbmQubW9ja1Jlc29sdmVkVmFsdWUoeyBJdGVtczogbW9ja0l0ZW1zIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5nZXRWaWRlb0FuYWx5dGljcygzMCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsVmlkZW9zKS50b0JlKDIpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnB1Ymxpc2hlZFZpZGVvcykudG9CZSgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFZpZXdzKS50b0JlKDEwMDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsUmV2ZW51ZSkudG9CZSgxMCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxDb3N0cykudG9CZSg2KTsgLy8gKDIrMSkgKyAoMisxKVxyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0JyZWFrZG93bltWaWRlb1N0YXR1cy5QVUJMSVNIRURdKS50b0JlKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0JyZWFrZG93bltWaWRlb1N0YXR1cy5HRU5FUkFUSU5HXSkudG9CZSgxKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBkYXRlUGVyZm9ybWFuY2VNZXRyaWNzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgcGVyZm9ybWFuY2UgbWV0cmljcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXhpc3RpbmdWaWRlbyA9IFZpZGVvTWV0YWRhdGFNb2RlbC5jcmVhdGUoXHJcbiAgICAgICAgJ1Rlc3QgVmlkZW8nLFxyXG4gICAgICAgICdUZXN0IERlc2NyaXB0aW9uJyxcclxuICAgICAgICBbJ3RhZzEnXSxcclxuICAgICAgICBbJ3RvdXJpc20nXSxcclxuICAgICAgICAnczM6Ly9idWNrZXQvdmlkZW8ubXA0J1xyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gTW9jayBnZXRWaWRlbyBjYWxsXHJcbiAgICAgIG1vY2tDbGllbnQuc2VuZFxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBJdGVtOiBWaWRlb01ldGFkYXRhTW9kZWwudG9EeW5hbW9EYkl0ZW0oZXhpc3RpbmdWaWRlbykgfSlcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgXHJcbiAgICAgICAgICBBdHRyaWJ1dGVzOiB7XHJcbiAgICAgICAgICAgIC4uLlZpZGVvTWV0YWRhdGFNb2RlbC50b0R5bmFtb0RiSXRlbShleGlzdGluZ1ZpZGVvKSxcclxuICAgICAgICAgICAgcGVyZm9ybWFuY2VNZXRyaWNzOiB7IGltcHJlc3Npb25zOiA1MDAwLCBjbGlja1Rocm91Z2hSYXRlOiAwLjA1IH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkudXBkYXRlUGVyZm9ybWFuY2VNZXRyaWNzKGV4aXN0aW5nVmlkZW8udmlkZW9JZCwge1xyXG4gICAgICAgIGltcHJlc3Npb25zOiA1MDAwLFxyXG4gICAgICAgIGNsaWNrVGhyb3VnaFJhdGU6IDAuMDVcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnBlcmZvcm1hbmNlTWV0cmljcy5pbXByZXNzaW9ucykudG9CZSg1MDAwKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5wZXJmb3JtYW5jZU1ldHJpY3MuY2xpY2tUaHJvdWdoUmF0ZSkudG9CZSgwLjA1KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXX0=